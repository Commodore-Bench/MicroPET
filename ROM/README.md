
# ROM contents

This folder contains files and code to build a ROM image that can be burned into the 512k ROM on the board, so that it actually boots.

- iplldr.a65: initial program loader, boots the machine by:
-- copying over character ROM image from start of ROM ($0f0000) to start of bank 7 (in RAM)
-- letting the user select which machine to boot (BASIC 2, BASIC 4/40 columns, BASIC 4/80 columns)
-- copying over selected PET ROM image to bank 0 ($a000-$ffff) ...
-- and executes a JMP through the RESET vector

For this work the ROM needs to contain:
- boot code
- character ROM
- system ROMs

## SPI FLash Memory Map

The IPL triggered by the CPLD loads the first 256 byte from the SPI flash. Following that is the
rest of the boot code as loaded by the initial IPL loader.
Then follow the various ROM images.

	Boot Image

        +----+ $0FFFF
        |    |         BASIC 4 80 columns editor ROM C64 keyboard
        +----+ $0F000
        |    |         BASIC 4 40 columns editor ROM C64 keyboard
        +----+ $0E000
        |    |         BASIC 4 kernal
        +----+ $0d000
        |    |         BASIC 4 40 columns editor ROM
        +----+ $0c000
        |    |         BASIC4 ROMs
        |    |         ($b000-$dfff)
        |    |  
        +----+ $09000
        |    |         BASIC 4 80 columns editor ROM
        +----+ $08000
        |    |         BASIC 2 
        |    |         ROM image ($c000-$ffff)
        |    |
        |    |
        +----+ $04000
        |    |         8k PET charrom
        |    |         (16 byte per character)
        +----+ $02000
        |    |         4k reserve (free)
        +----+ $01000
        |    |         Boot loader, first 256 byte IPL's by CPLD
        +----+ $00000

## Build

To build the ROM, just run "make".
This build process for bootimg downloads the necessary ROM images from the internet, builds the boot loader, and combines everything into a single boot image.
Then burn the resulting file "spiimg" into the lowest bank of the SPI Flash ROM (Address 0)

## Files

The following files are test files, or to build the ROMs:

- char8to16.c: converts a character ROM with 8 pixel rows per character to a 16 row per character image
- charPet2Invers.c: a PET charrom is only 2k and lacks inverted characters, as they are generated by hardware. This small program creates, from the 2k PET image, a full 4k image that contains the inverted characeters




