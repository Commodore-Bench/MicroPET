
# ROM contents

This folder contains files and code to build a ROM image that can be burned into the 512k ROM on the board, so that it actually boots.

- iplldr.a65: initial program loader, boots the machine by:
-- copying over character ROM image from start of ROM ($0f0000) to start of bank 7 (in RAM)
-- letting the user select which machine to boot (BASIC 2, BASIC 4/40 columns, BASIC 4/80 columns)
-- copying over selected PET ROM image to bank 0 ($a000-$ffff) ...
-- and executes a JMP through the RESET vector

For this work the ROM needs to contain:
- boot code
- character ROM
- system ROMs

## SPI FLash Memory Map

The IPL triggered by the CPLD loads the first 256 byte from the SPI flash. Following that is the
rest of the boot code as loaded by the initial IPL loader.
Then follow the various ROM images.

	Boot Image

        +----+ $0FFFF
        |    |         BASIC 4 80 columns editor ROM C64 keyboard
        +----+ $0F000
        |    |         BASIC 4 40 columns editor ROM C64 keyboard
        +----+ $0E000
        |    |         BASIC 4 kernal
        +----+ $0d000
        |    |         BASIC 4 40 columns editor ROM
        +----+ $0c000
        |    |         BASIC4 ROMs
        |    |         ($b000-$dfff)
        |    |  
        +----+ $09000
        |    |         BASIC 4 80 columns editor ROM
        +----+ $08000
        |    |         BASIC 2 
        |    |         ROM image ($c000-$ffff)
        |    |
        |    |
        +----+ $04000
        |    |         8k PET charrom
        |    |         (16 byte per character)
        +----+ $02000
        |    |         4k @MON in the PET4 variant (without editor extension)
        +----+ $01000
        |    |         Boot loader, first 256 byte IPL's by CPLD
        +----+ $00000

## Build

To build the ROM, just run "make".
This build process for bootimg downloads the necessary ROM images from the internet, builds the boot loader, and combines everything into a single boot image.
Then burn the resulting file "spiimg" into the lowest bank of the SPI Flash ROM (Address 0)

## Files

The following files are test files, or to build the ROMs:

- char8to16.c: converts a character ROM with 8 pixel rows per character to a 16 row per character image
- charPet2Invers.c: a PET charrom is only 2k and lacks inverted characters, as they are generated by hardware. This small program creates, from the 2k PET image, a full 4k image that contains the inverted characeters
- edit....asm: control files for Steve Gray's editor ROM project, to build the custom editor ROMs
-- edit40gx: 40 column for graphics keyboard with wedge and special keys
-- edit80gx: 80 column for graphics keyboard with wedge and special keys
-- edit40gc: 40 column for C64 keyboard with wedge and special keys
-- edit80gc: 80 column for C64 keyboard with wedge and special keys

## ROM features

The editor ROMs are non-standard, and feature some extensions.
Note that they are only available for BASIC 4 variants. BASIC 2 is only, well, standard BASIC 2.

### Graphics keyboard ROMs

These are derived from the standard PET ROMs, but feature some extensions:

1. Shift + '@': switch between text and graphics display.
1. '@' + Left-Shift + Right-Shift + DEL: reset the PET

### C64 keyboard ROMs

The ...gc ROM files enable the use of a C64 keyboard instead of a PET graphics keyboard. 
The initial boot loader, where the model is selected detects the keyboard used using the numbers
pressed to select the model, and automatically loads the correct ROM.

Note that due to code size restrictions, only the normal and shifted keys are supported. CBM and Control
are currently ignored.

The follwing features are present:

1. Shift + Left-Arrow: switch between text and graphics display.
1. Left-Arrow + Left-Shift + Right-Shift + DEL: reset the PET

### Extended machine language monitor

In the ROM area at $a000 there is the @MON machine language monitor included (with assembler
and disassembler, and versatile search functions). 

Note that the scrolling editor is (for now) disabled due to incompatibilities with the modified
editor ROMs.

