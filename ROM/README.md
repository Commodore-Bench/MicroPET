
# ROM contents

This folder contains files and code to build a ROM image that can be burned into the 512k ROM on the board, so that it actually boots.

- bootldr.a65: boots the machine by:
-- letting the user select which machine to boot (BASIC 2, BASIC 4/40 columns, BASIC 4/80 columns)
-- copying over character ROM image from start of ROM ($0f0000) to start of bank 7 (in RAM)
-- copying over selected PET ROM image to bank 0 ($a000-$ffff) - the CPLD ignores I/O writes
-- copy some trampoline code into zeropage, and jump to it. This code disables init, and boots the PET ROM

For this work the ROM needs to contain:
- boot code
- character ROM
- system ROMs

## Memory Map

The boot files occupy the uppermost bank of the ROM, i.e. bank 15 in the CPU address space.
The uppermost 16k of that area are mapped into the uppermost 16k of bank 0 during the init phase to boot the CPU.

	Boot Image

        +----+ $0FFFFF
        |    |        Boot loader 
        +----+ $0FF000
        |    |        12k empty
        |    |
        |    |  
        +----+ $0FC000
        |    |         BASIC 4/40 columns
        |    |         ROM image ($b000-$ffff)
        |    |
        |    |
        |    |
        +----+ $0F7000
        |    |         BASIC 4 80 columns editor ROM (2k + 2k reserved)
        +----+ $0F6000
        |    |         BASIC 2 
        |    |         ROM image ($c000-$ffff)
        |    |
        |    |
        +----+ $0F2000
        |    |         8k character ROM
        |    |         (2 sets, 16 rows per character)
        +----+ $0F0000

## Build

To build the ROM, just run "make".
This build process for bootimg downloads the necessary ROM images from the internet, builds the boot loader, and combines everything into a single boot image.
Then burn the resulting file "bootimg" into the uppermost bank of the 512k ROM chip at address $70000.

## Files

The following files are test files, or to build the ROMs:

- char8to16.c: converts a character ROM with 8 pixel rows per character to a 16 row per character image
- charPet2Invers.c: a PET charrom is only 2k and lacks inverted characters, as they are generated by hardware. This small program creates, from the 2k PET image, a full 4k image that contains the inverted characeters
- romtest01(a).a65: This test program fills bank 1 continuously with an increasing value. This can be used to check the hires mode. The output of its build has to be copied into the top 4k of the ROM to boot/run
- romtest02(a).a65: This test program copies an 8k character ROM image from start of the ROM to start of bank 7, where the video code takes its character information. Then fills the character screen, and continuously increase the value in the character screen at $008000. This tests the character display output. The output of its build has to be copied into the top 4k of the ROM to boot/run



